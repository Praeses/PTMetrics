@model dynamic

@{
    ViewBag.Title = "title";
}

<h2>Stories</h2>
<section id="charts">
<div id="piechart" style="width: auto; height: auto; margin: 0 auto"></div>
</section>
<button id="pie">reset</button>​

@section scripts{
    <script type="text/javascript">
        $(function () {
            var chart,
                data = [
                        {
                            name: 'A',
                            y: 15,
                            drilldown: {
                                name: 'A',
                                data: [
                                    { name: 'A1', y: 5 }
                                    , { name: 'A2', y: 6 }
                                    , { name: 'A3', y: 7 }
                                    , { name: 'A4', y: 8 }
                                ]
                            }
                        },
                        {
                            name: 'B',
                            y: 10,
                            drilldown: {
                                name: 'B',
                                data: [
                                    { name: 'B1', y: 8 }
                                    , { name: 'B2', y: 9 }
                                    , { name: 'B3', y: 2 }
                                    , { name: 'B4', y: 1 }
                                ]
                            }
                        },
                        {
                            name: 'C',
                            y: 5,
                            drilldown: {
                                name: 'C',
                                data: [
                                    { name: 'C1', y: 10 }
                                    , { name: 'C2', y: 3 }
                                    , { name: 'C3', y: 2 }
                                    , { name: 'C4', y: 7 }
                                ]
                            }
                        },
            ];
    
        $(document).ready(function () {
    	
            // Build the chart
            chart = new Highcharts.Chart({
                chart: {
                    renderTo: 'piechart',
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: 'Project Stories'
                },
                tooltip: {
        	        pointFormat: '{series.name}: <b>{point.percentage}%</b>',
                    percentageDecimals: 1
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true,
                        point: {
                            events: {
                                click: function () {
                                    var chart = this.series.chart,
                                        drilldown = this.drilldown;
                                    if (drilldown) { // drill down
                                        chart.setChart(drilldown.name, drilldown.data);
                                    }
                                }
                            }
                        },
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Stories',
                    data: data
                }]
            }, function (chart) {

                chart.upper = [];

                var up = false;

                chart.setChart = function (name, data) {
                    if (name === true && chart.upper.length > 0) {
                        chart.series[0].remove();
                        chart.addSeries(chart.upper.pop());

                        if (chart.upper.length === 0) {
                            $("#pie").hide('up');
                            up = false;
                        }
                        return true;
                    }

                    if (up === false) {
                        $("#pie").show().bind('click', function () { chart.setChart(true); });
                        up = true;
                    }

                    chart.upper.push(chart.series[0].options);
                    chart.series[0].remove();
                    chart.addSeries({
                        type: 'pie',
                        name: name,
                        data: data
                    });
                }



            });
        });
    
        });
    </script>
}